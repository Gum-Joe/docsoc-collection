# This file is generated by Nx.
#
# Build the docker image with `npx nx docker-build fastify-api`.
# Tip: Modify "docker-build" options in project.json to change docker build args.
#
# Run the container with `docker run -p 4040:4040 -t gumjoe/docsoc-collection-api`.
FROM node:lts

ENV HOST=0.0.0.0
ENV PORT=4040

EXPOSE 4040

# Copy contents
COPY . /docsoc
WORKDIR /docsoc

# Make a user
RUN useradd -ms /bin/bash docsoc

# CHMOD
RUN chown -R docsoc /docsoc

# Switch to the user
USER docsoc

# Install dependencies
RUN npm ci

# CD fastify-api, install
RUN cd apps/fastify-api && npm install
RUN cd apps/fastify-api && npx prisma generate

CMD [ "npx", "nx", "serve", "fastify-api", "--configuration=production" ]
